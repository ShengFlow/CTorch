<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ctorch: Storage.h 源文件</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.jpg"/></td>
  <td id="projectalign">
   <div id="projectname">Ctorch<span id="projectnumber">&#160;RC v1.0</span>
   </div>
   <div id="projectbrief">一个高性能C++ ML库</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- 制作者 Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','搜索',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('_storage_8h_source.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">载入中...</div>
<div class="SRStatus" id="Searching">搜索中...</div>
<div class="SRStatus" id="NoMatches">未找到</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Storage.h</div></div>
</div><!--header-->
<div class="contents">
<a href="_storage_8h.html">浏览该文件的文档.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#ifndef STORAGE_H</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#define STORAGE_H</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &quot;<a class="code" href="_ctools_8h.html">Ctools.h</a>&quot;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &quot;<a class="code" href="_ctorch___error_8h.html">Ctorch_Error.h</a>&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span></div>
<div class="foldopen" id="foldopen00020" data-start="{" data-end="};">
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno"><a class="line" href="class_storage.html">   20</a></span><span class="keyword">class </span><a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a> {</div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="keyword">private</span>:</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>   <span class="keywordtype">size_t</span> _size{};</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>   </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>   <a class="code hl_enumeration" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30">DType</a> _dtype;</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>   </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>   <a class="code hl_enumeration" href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9">DeviceType</a> _device;</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>   </div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>   std::shared_ptr&lt;char[]&gt; _data;</div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>   <span class="keywordtype">void</span> checkDType()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>       <span class="keywordflow">if</span> ((std::is_same&lt;T, float&gt;::value &amp;&amp; _dtype != <a class="code hl_enumvalue" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a8425cd882e78bc9251db970b8a1da20e">DType::kFloat</a>) ||</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>           (std::is_same&lt;T, double&gt;::value &amp;&amp; _dtype != <a class="code hl_enumvalue" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a7fb3efa35444cd88d5a31dc125ca9c28">DType::kDouble</a>) ||</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>           (std::is_same&lt;T, int32_t&gt;::value &amp;&amp; _dtype != <a class="code hl_enumvalue" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a355088fbd6ac81f051e0bd6ede5ab8e0">DType::kInt</a>) ||</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>           (std::is_same&lt;T, int64_t&gt;::value &amp;&amp; _dtype != <a class="code hl_enumvalue" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a6a285ab26ec7ec4c22536626eeaaf52e">DType::kLong</a>) ||</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>           (std::is_same&lt;T, bool&gt;::value &amp;&amp; _dtype != <a class="code hl_enumvalue" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a18268c9f691ba5a5f650049d9d0da8dc">DType::kBool</a>)) {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>           std::cerr &lt;&lt; <span class="stringliteral">&quot;Storage data type mismatch: T=&quot;</span> &lt;&lt; <span class="keyword">typeid</span>(T).name()</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>                     &lt;&lt; <span class="stringliteral">&quot;, dtype=&quot;</span> &lt;&lt; <a class="code hl_function" href="_ctools_8h.html#a9714aa0bb82443781681f9512357a873">dtypeToString</a>(_dtype) &lt;&lt; std::endl;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>           <a class="code hl_function" href="class_ctorch___error.html#a4850c089416b2a55a8eed47bd212b91f">Ctorch_Error::log</a>(<a class="code hl_enumvalue" href="_ctools_8h.html#a88f6d947bf467e369055535af5907aa1abb1ca97ec761fc37101737ba0aa2e7c5">ErrorLevel::ERROR</a>,<a class="code hl_enumvalue" href="_ctools_8h.html#ac325c5970308dcd6b065d1de90a0711ba63cf1c5a8190ef348344ddcec79a8034">ErrorPlatform::kGENERAL</a>,<a class="code hl_enumvalue" href="_ctools_8h.html#ab0df38968e4f03a3f1f6d6df0f31f45aa02ff2101e64dbed6c34c715aa8d5cfea">ErrorType::DATATYPE</a>,<span class="stringliteral">&quot;数据类型不匹配！&quot;</span>);</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>           <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Storage data type mismatch&quot;</span>);</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>       }</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>   }</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span> </div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="keyword">public</span>:</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno"><a class="line" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">   77</a></span>    <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>(<span class="keywordtype">size_t</span> <a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a>, <a class="code hl_enumeration" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30">DType</a> <a class="code hl_function" href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">dtype</a>, <a class="code hl_enumeration" href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9">DeviceType</a> <a class="code hl_function" href="class_storage.html#a9e895c738d926a0b9de0955580502a48">device</a> = <a class="code hl_enumvalue" href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9a2ce310327f474afc9f6774faa2f57903">DeviceType::kCPU</a>): _size(<a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a>), _dtype(<a class="code hl_function" href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">dtype</a>), _device(<a class="code hl_function" href="class_storage.html#a9e895c738d926a0b9de0955580502a48">device</a>),_data(<a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a> &gt; 0 ? std::shared_ptr&lt;char[]&gt;(new char[<a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a> * <a class="code hl_function" href="_ctools_8h.html#a5990bac822ce4d7accccc75041602fe5">dtypeSize</a>(<a class="code hl_function" href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">dtype</a>)]) : nullptr) {}</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="foldopen" id="foldopen00089" data-start="{" data-end="}">
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno"><a class="line" href="class_storage.html#a7c40c24036aec89008531f69aad0f3fd">   89</a></span>    <a class="code hl_function" href="class_storage.html#a7c40c24036aec89008531f69aad0f3fd">Storage</a>(<span class="keyword">const</span> T* <a class="code hl_function" href="class_storage.html#a9cc14204d6132c76cbd0a8e0edc34c2e">data</a>, <span class="keywordtype">size_t</span> <a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a>, <a class="code hl_enumeration" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30">DType</a> <a class="code hl_function" href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">dtype</a>, <a class="code hl_enumeration" href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9">DeviceType</a> <a class="code hl_function" href="class_storage.html#a9e895c738d926a0b9de0955580502a48">device</a> = <a class="code hl_enumvalue" href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9a2ce310327f474afc9f6774faa2f57903">DeviceType::kCPU</a>): <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>(<a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a>, <a class="code hl_function" href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">dtype</a>, <a class="code hl_function" href="class_storage.html#a9e895c738d926a0b9de0955580502a48">device</a>) {</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a> &gt; 0 &amp;&amp; _data.get()) {</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>            std::memcpy(_data.get(), data, size * dtypeSize(dtype));</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>        }</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    }</div>
</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno"><a class="line" href="class_storage.html#a32bcd05cb3d102a9d68a07628e5e2ab4">   98</a></span>    <a class="code hl_function" href="class_storage.html#a32bcd05cb3d102a9d68a07628e5e2ab4">Storage</a>(<span class="keyword">const</span> <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    </div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno"><a class="line" href="class_storage.html#ac697deb6dde9459da3f866bca3f0ddb6">  103</a></span>    <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>&amp; <a class="code hl_function" href="class_storage.html#ac697deb6dde9459da3f866bca3f0ddb6">operator=</a>(<span class="keyword">const</span> <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno"><a class="line" href="class_storage.html#a5f916b176088ca0162dbaf4a18f47b7c">  108</a></span>    <a class="code hl_function" href="class_storage.html#a5f916b176088ca0162dbaf4a18f47b7c">Storage</a>(<a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>&amp;&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno"><a class="line" href="class_storage.html#ad380d936cc428823fdda16a93aaf393f">  113</a></span>    <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>&amp; <a class="code hl_function" href="class_storage.html#ad380d936cc428823fdda16a93aaf393f">operator=</a>(<a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a>&amp;&amp;) = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno"><a class="line" href="class_storage.html#a80ef6af5e4c9fd4424ae16e808d05291">  119</a></span>    <a class="code hl_function" href="class_storage.html#a80ef6af5e4c9fd4424ae16e808d05291">Storage</a>() : _size(0), _dtype(<a class="code hl_enumeration" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30">DType</a>::<a class="code hl_enumvalue" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a8425cd882e78bc9251db970b8a1da20e">kFloat</a>), _device(<a class="code hl_enumeration" href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9">DeviceType</a>::<a class="code hl_enumvalue" href="_ctools_8h.html#ac325c5970308dcd6b065d1de90a0711ba2ce310327f474afc9f6774faa2f57903">kCPU</a>) {}</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno"><a class="line" href="class_storage.html#abe04a4c50447d0127247d9401857f167">  124</a></span>    <a class="code hl_function" href="class_storage.html#abe04a4c50447d0127247d9401857f167">~Storage</a>() = <span class="keywordflow">default</span>;</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="foldopen" id="foldopen00132" data-start="{" data-end="}">
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno"><a class="line" href="class_storage.html#a9cc14204d6132c76cbd0a8e0edc34c2e">  132</a></span>    T* <a class="code hl_function" href="class_storage.html#a9cc14204d6132c76cbd0a8e0edc34c2e">data</a>() {</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        <span class="keywordflow">if</span> (_size == 0 || !_data) {</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        }</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>        checkDType&lt;T&gt;();</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>        T* result = <span class="keyword">reinterpret_cast&lt;</span>T*<span class="keyword">&gt;</span>(_data.get());</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        <span class="keywordflow">return</span> result;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    }</div>
</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="foldopen" id="foldopen00147" data-start="{" data-end="}">
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno"><a class="line" href="class_storage.html#a18af33a8031e1b58bca84e7abf8de341">  147</a></span>    <span class="keyword">const</span> T* <a class="code hl_function" href="class_storage.html#a18af33a8031e1b58bca84e7abf8de341">data</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>        <span class="keywordflow">if</span> (_size == 0 || !_data) <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        checkDType&lt;T&gt;();</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>        <span class="keywordflow">return</span> <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>T*<span class="keyword">&gt;</span>(_data.get());</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    }</div>
</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno"><a class="line" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">  157</a></span>    <span class="keywordtype">size_t</span> <a class="code hl_function" href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _size; }</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno"><a class="line" href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">  163</a></span>    <a class="code hl_enumeration" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30">DType</a> <a class="code hl_function" href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">dtype</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _dtype; }</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="class_storage.html#a9e895c738d926a0b9de0955580502a48">  169</a></span>    <a class="code hl_enumeration" href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9">DeviceType</a> <a class="code hl_function" href="class_storage.html#a9e895c738d926a0b9de0955580502a48">device</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _device; }</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span></div>
<div class="foldopen" id="foldopen00175" data-start="{" data-end="}">
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno"><a class="line" href="class_storage.html#adcd8e23907c1c3d0f6d1c0418ebabe61">  175</a></span>    <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a> <a class="code hl_function" href="class_storage.html#adcd8e23907c1c3d0f6d1c0418ebabe61">clone</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        <a class="code hl_function" href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage</a> new_storage(_size, _dtype, _device);</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <span class="keywordflow">if</span> (_size &gt; 0 &amp;&amp; _data) {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>            std::memcpy(new_storage._data.get(), _data.get(), _size * <a class="code hl_function" href="_ctools_8h.html#a5990bac822ce4d7accccc75041602fe5">dtypeSize</a>(_dtype));</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>            <span class="comment">// 验证复制是否正确</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>            <span class="keywordflow">if</span> (_dtype == <a class="code hl_enumvalue" href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a8425cd882e78bc9251db970b8a1da20e">DType::kFloat</a> &amp;&amp; _size &gt; 0) {</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>                <span class="keyword">const</span> <span class="keywordtype">float</span>* src = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">float</span>*<span class="keyword">&gt;</span>(_data.get());</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>                <span class="keywordtype">float</span>* dst = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">float</span>*<span class="keyword">&gt;</span>(new_storage._data.get());</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>            }</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        }</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="keywordflow">return</span> new_storage;</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    }</div>
</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>    </div>
<div class="foldopen" id="foldopen00193" data-start="{" data-end="}">
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno"><a class="line" href="class_storage.html#a90311302b713775e503a253ab4aab3e8">  193</a></span>    <span class="keywordtype">void</span> <a class="code hl_function" href="class_storage.html#a90311302b713775e503a253ab4aab3e8">clear</a>() {</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>       _data.reset();</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>       _size = 0;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>   }</div>
</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span></div>
<div class="foldopen" id="foldopen00202" data-start="{" data-end="}">
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno"><a class="line" href="class_storage.html#a73a6bbb5e327aa93602899704858ecc0">  202</a></span>    <span class="keywordtype">bool</span> <a class="code hl_function" href="class_storage.html#a73a6bbb5e327aa93602899704858ecc0">empty</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>       <span class="keywordflow">return</span> _size == 0 || !_data;</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>   }</div>
</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>};</div>
</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="preprocessor">#endif </span><span class="comment">//STORAGE_H</span></div>
<div class="ttc" id="a_ctools_8h_html"><div class="ttname"><a href="_ctools_8h.html">Ctools.h</a></div><div class="ttdoc">Ctorch 通用工具类，包含通用枚举类型和辅助函数</div></div>
<div class="ttc" id="a_ctools_8h_html_a5990bac822ce4d7accccc75041602fe5"><div class="ttname"><a href="_ctools_8h.html#a5990bac822ce4d7accccc75041602fe5">dtypeSize</a></div><div class="ttdeci">constexpr size_t dtypeSize(DType dtype)</div><div class="ttdoc">获取数据类型的字节大小</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00273">Ctools.h:273</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a88f6d947bf467e369055535af5907aa1abb1ca97ec761fc37101737ba0aa2e7c5"><div class="ttname"><a href="_ctools_8h.html#a88f6d947bf467e369055535af5907aa1abb1ca97ec761fc37101737ba0aa2e7c5">ErrorLevel::ERROR</a></div><div class="ttdeci">@ ERROR</div><div class="ttdoc">功能异常（如kernel执行失败）</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00089">Ctools.h:89</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a96f6c2a9728066fa81235ada8a5dbc30"><div class="ttname"><a href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30">DType</a></div><div class="ttdeci">DType</div><div class="ttdoc">数据类型枚举，定义张量元素的类型</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00162">Ctools.h:162</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a96f6c2a9728066fa81235ada8a5dbc30a18268c9f691ba5a5f650049d9d0da8dc"><div class="ttname"><a href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a18268c9f691ba5a5f650049d9d0da8dc">DType::kBool</a></div><div class="ttdeci">@ kBool</div><div class="ttdoc">布尔值 (torch.bool)</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00167">Ctools.h:167</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a96f6c2a9728066fa81235ada8a5dbc30a355088fbd6ac81f051e0bd6ede5ab8e0"><div class="ttname"><a href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a355088fbd6ac81f051e0bd6ede5ab8e0">DType::kInt</a></div><div class="ttdeci">@ kInt</div><div class="ttdoc">32位整数 (torch.int32)</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00165">Ctools.h:165</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a96f6c2a9728066fa81235ada8a5dbc30a6a285ab26ec7ec4c22536626eeaaf52e"><div class="ttname"><a href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a6a285ab26ec7ec4c22536626eeaaf52e">DType::kLong</a></div><div class="ttdeci">@ kLong</div><div class="ttdoc">64位整数 (torch.int64)</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00166">Ctools.h:166</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a96f6c2a9728066fa81235ada8a5dbc30a7fb3efa35444cd88d5a31dc125ca9c28"><div class="ttname"><a href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a7fb3efa35444cd88d5a31dc125ca9c28">DType::kDouble</a></div><div class="ttdeci">@ kDouble</div><div class="ttdoc">64位浮点数 (torch.float64)</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00164">Ctools.h:164</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a96f6c2a9728066fa81235ada8a5dbc30a8425cd882e78bc9251db970b8a1da20e"><div class="ttname"><a href="_ctools_8h.html#a96f6c2a9728066fa81235ada8a5dbc30a8425cd882e78bc9251db970b8a1da20e">DType::kFloat</a></div><div class="ttdeci">@ kFloat</div><div class="ttdoc">32位浮点数 (torch.float32)</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00163">Ctools.h:163</a></div></div>
<div class="ttc" id="a_ctools_8h_html_a9714aa0bb82443781681f9512357a873"><div class="ttname"><a href="_ctools_8h.html#a9714aa0bb82443781681f9512357a873">dtypeToString</a></div><div class="ttdeci">constexpr const char * dtypeToString(DType dtype)</div><div class="ttdoc">将数据类型转换为字符串表示</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00257">Ctools.h:257</a></div></div>
<div class="ttc" id="a_ctools_8h_html_ab0df38968e4f03a3f1f6d6df0f31f45aa02ff2101e64dbed6c34c715aa8d5cfea"><div class="ttname"><a href="_ctools_8h.html#ab0df38968e4f03a3f1f6d6df0f31f45aa02ff2101e64dbed6c34c715aa8d5cfea">ErrorType::DATATYPE</a></div><div class="ttdeci">@ DATATYPE</div><div class="ttdoc">数据类型（不匹配/转换失败/不支持的类型）</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00115">Ctools.h:115</a></div></div>
<div class="ttc" id="a_ctools_8h_html_ac325c5970308dcd6b065d1de90a0711ba2ce310327f474afc9f6774faa2f57903"><div class="ttname"><a href="_ctools_8h.html#ac325c5970308dcd6b065d1de90a0711ba2ce310327f474afc9f6774faa2f57903">ErrorPlatform::kCPU</a></div><div class="ttdeci">@ kCPU</div><div class="ttdoc">CPU设备</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00098">Ctools.h:98</a></div></div>
<div class="ttc" id="a_ctools_8h_html_ac325c5970308dcd6b065d1de90a0711ba63cf1c5a8190ef348344ddcec79a8034"><div class="ttname"><a href="_ctools_8h.html#ac325c5970308dcd6b065d1de90a0711ba63cf1c5a8190ef348344ddcec79a8034">ErrorPlatform::kGENERAL</a></div><div class="ttdeci">@ kGENERAL</div><div class="ttdoc">通用设备</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00103">Ctools.h:103</a></div></div>
<div class="ttc" id="a_ctools_8h_html_ad258d4c51629346fceac4679b3209ad9"><div class="ttname"><a href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9">DeviceType</a></div><div class="ttdeci">DeviceType</div><div class="ttdoc">设备类型枚举，定义张量存储的位置</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00149">Ctools.h:149</a></div></div>
<div class="ttc" id="a_ctools_8h_html_ad258d4c51629346fceac4679b3209ad9a2ce310327f474afc9f6774faa2f57903"><div class="ttname"><a href="_ctools_8h.html#ad258d4c51629346fceac4679b3209ad9a2ce310327f474afc9f6774faa2f57903">DeviceType::kCPU</a></div><div class="ttdeci">@ kCPU</div><div class="ttdoc">CPU设备</div><div class="ttdef"><b>定义</b> <a href="_ctools_8h_source.html#l00150">Ctools.h:150</a></div></div>
<div class="ttc" id="a_ctorch___error_8h_html"><div class="ttname"><a href="_ctorch___error_8h.html">Ctorch_Error.h</a></div><div class="ttdoc">Ctorch 错误处理类</div></div>
<div class="ttc" id="aclass_ctorch___error_html_a4850c089416b2a55a8eed47bd212b91f"><div class="ttname"><a href="class_ctorch___error.html#a4850c089416b2a55a8eed47bd212b91f">Ctorch_Error::log</a></div><div class="ttdeci">static void log(ErrorLevel level, ErrorPlatform platform, ErrorType type, const std::string msg)</div><div class="ttdoc">记录日志信息</div><div class="ttdef"><b>定义</b> <a href="_ctorch___error_8h_source.html#l00352">Ctorch_Error.h:352</a></div></div>
<div class="ttc" id="aclass_storage_html_a119f47ac1147d4c26fe21ac262e2ff70"><div class="ttname"><a href="class_storage.html#a119f47ac1147d4c26fe21ac262e2ff70">Storage::dtype</a></div><div class="ttdeci">DType dtype() const</div><div class="ttdoc">获取数据类型</div><div class="ttdef"><b>定义</b> <a href="#l00163">Storage.h:163</a></div></div>
<div class="ttc" id="aclass_storage_html_a18af33a8031e1b58bca84e7abf8de341"><div class="ttname"><a href="class_storage.html#a18af33a8031e1b58bca84e7abf8de341">Storage::data</a></div><div class="ttdeci">const T * data() const</div><div class="ttdoc">获取常量原始数据的类型化指针</div><div class="ttdef"><b>定义</b> <a href="#l00147">Storage.h:147</a></div></div>
<div class="ttc" id="aclass_storage_html_a32bcd05cb3d102a9d68a07628e5e2ab4"><div class="ttname"><a href="class_storage.html#a32bcd05cb3d102a9d68a07628e5e2ab4">Storage::Storage</a></div><div class="ttdeci">Storage(const Storage &amp;)=default</div><div class="ttdoc">默认拷贝构造函数（浅拷贝）</div></div>
<div class="ttc" id="aclass_storage_html_a5f916b176088ca0162dbaf4a18f47b7c"><div class="ttname"><a href="class_storage.html#a5f916b176088ca0162dbaf4a18f47b7c">Storage::Storage</a></div><div class="ttdeci">Storage(Storage &amp;&amp;)=default</div><div class="ttdoc">默认移动构造函数</div></div>
<div class="ttc" id="aclass_storage_html_a73a6bbb5e327aa93602899704858ecc0"><div class="ttname"><a href="class_storage.html#a73a6bbb5e327aa93602899704858ecc0">Storage::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdoc">检查存储是否为空</div><div class="ttdef"><b>定义</b> <a href="#l00202">Storage.h:202</a></div></div>
<div class="ttc" id="aclass_storage_html_a7c40c24036aec89008531f69aad0f3fd"><div class="ttname"><a href="class_storage.html#a7c40c24036aec89008531f69aad0f3fd">Storage::Storage</a></div><div class="ttdeci">Storage(const T *data, size_t size, DType dtype, DeviceType device=DeviceType::kCPU)</div><div class="ttdoc">构造函数：从现有数据复制</div><div class="ttdef"><b>定义</b> <a href="#l00089">Storage.h:89</a></div></div>
<div class="ttc" id="aclass_storage_html_a80ef6af5e4c9fd4424ae16e808d05291"><div class="ttname"><a href="class_storage.html#a80ef6af5e4c9fd4424ae16e808d05291">Storage::Storage</a></div><div class="ttdeci">Storage()</div><div class="ttdoc">默认构造函数</div><div class="ttdef"><b>定义</b> <a href="#l00119">Storage.h:119</a></div></div>
<div class="ttc" id="aclass_storage_html_a8db0553545d737f266f5a3c7008e6112"><div class="ttname"><a href="class_storage.html#a8db0553545d737f266f5a3c7008e6112">Storage::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdoc">获取存储中的元素数量</div><div class="ttdef"><b>定义</b> <a href="#l00157">Storage.h:157</a></div></div>
<div class="ttc" id="aclass_storage_html_a90311302b713775e503a253ab4aab3e8"><div class="ttname"><a href="class_storage.html#a90311302b713775e503a253ab4aab3e8">Storage::clear</a></div><div class="ttdeci">void clear()</div><div class="ttdoc">清空存储</div><div class="ttdef"><b>定义</b> <a href="#l00193">Storage.h:193</a></div></div>
<div class="ttc" id="aclass_storage_html_a9cc14204d6132c76cbd0a8e0edc34c2e"><div class="ttname"><a href="class_storage.html#a9cc14204d6132c76cbd0a8e0edc34c2e">Storage::data</a></div><div class="ttdeci">T * data()</div><div class="ttdoc">获取原始数据的类型化指针</div><div class="ttdef"><b>定义</b> <a href="#l00132">Storage.h:132</a></div></div>
<div class="ttc" id="aclass_storage_html_a9e895c738d926a0b9de0955580502a48"><div class="ttname"><a href="class_storage.html#a9e895c738d926a0b9de0955580502a48">Storage::device</a></div><div class="ttdeci">DeviceType device() const</div><div class="ttdoc">获取设备类型</div><div class="ttdef"><b>定义</b> <a href="#l00169">Storage.h:169</a></div></div>
<div class="ttc" id="aclass_storage_html_abe04a4c50447d0127247d9401857f167"><div class="ttname"><a href="class_storage.html#abe04a4c50447d0127247d9401857f167">Storage::~Storage</a></div><div class="ttdeci">~Storage()=default</div><div class="ttdoc">默认析构函数</div></div>
<div class="ttc" id="aclass_storage_html_ac697deb6dde9459da3f866bca3f0ddb6"><div class="ttname"><a href="class_storage.html#ac697deb6dde9459da3f866bca3f0ddb6">Storage::operator=</a></div><div class="ttdeci">Storage &amp; operator=(const Storage &amp;)=default</div><div class="ttdoc">默认拷贝赋值运算符（浅拷贝）</div></div>
<div class="ttc" id="aclass_storage_html_ad380d936cc428823fdda16a93aaf393f"><div class="ttname"><a href="class_storage.html#ad380d936cc428823fdda16a93aaf393f">Storage::operator=</a></div><div class="ttdeci">Storage &amp; operator=(Storage &amp;&amp;)=default</div><div class="ttdoc">默认移动赋值运算符</div></div>
<div class="ttc" id="aclass_storage_html_adcd8e23907c1c3d0f6d1c0418ebabe61"><div class="ttname"><a href="class_storage.html#adcd8e23907c1c3d0f6d1c0418ebabe61">Storage::clone</a></div><div class="ttdeci">Storage clone() const</div><div class="ttdoc">创建存储的深拷贝</div><div class="ttdef"><b>定义</b> <a href="#l00175">Storage.h:175</a></div></div>
<div class="ttc" id="aclass_storage_html_af41bfec61a1d723bdc840dc205565e59"><div class="ttname"><a href="class_storage.html#af41bfec61a1d723bdc840dc205565e59">Storage::Storage</a></div><div class="ttdeci">Storage(size_t size, DType dtype, DeviceType device=DeviceType::kCPU)</div><div class="ttdoc">构造函数：分配未初始化的内存</div><div class="ttdef"><b>定义</b> <a href="#l00077">Storage.h:77</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="_storage_8h.html">Storage.h</a></li>
    <li class="footer">制作者 <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
