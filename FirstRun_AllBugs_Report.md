
# Table of Contents

1.  [说明：](#orgeb49dad)
2.  [问题：](#orgede3848)
    1.  [1.广播机制不完善](#org30a155f)
    2.  [2.自动微分类的设计缺陷](#orgfb69fb5)
    3.  [3.部分实现不完全、不优秀](#org6e2665a)
3.  [没有遇到但是需要检查的问题：](#org13a5773)



<a id="orgeb49dad"></a>

# 说明：

这是 Ctorch-v1 发布之前做的第一次系统测试报告；
报告包括：发现的所有bug、潜在的问题；
进行测试的代码为 ctorch-feature-nn.Module/src/dev/Tensor.h;


<a id="orgede3848"></a>

# 问题：


<a id="org30a155f"></a>

## 1.广播机制不完善

具体表现为：

1.  部分算子没有使用广播机制
2.  广播机制的正确性和通用性不好
3.  广播机制仍然是半自动的

修复后需要写一篇方案，保证正确性；


<a id="orgfb69fb5"></a>

## 2.自动微分类的设计缺陷

这是致命问题，导致AD完全不可用

1.  计算图键值依赖不稳定地址：

操作符重载内部创建的局部临时张量地址被注册到计算图，但返回给用户的张量是拷贝/移动后的新对象，地址不匹配
可以考虑使用唯一的标识标记Tensor，如UUID

2.   梯度需求属性未传播：

输出张量的requires<sub>grad</sub> 默认为false，未继承输入张量的设置

3.   记录时机错误：

record<sub>op</sub> 在局部对象销毁前调用，注册的地址后续无效


<a id="org6e2665a"></a>

## 3.部分实现不完全、不优秀

1.  矩阵乘法，需要根据编译平台进行分类，执行SIMD、AMX等；
2.  对于bool类的tensor（或者01矩阵），一个字节存放一个bool，造成了浪费，可以使用bitset，使一个字节存放8个bool；
    说明：这种方法损失了内存对齐，具体是否可行仍然需要测试；
3.  报错机制、提示过少；


<a id="org13a5773"></a>

# 没有遇到但是需要检查的问题：

整形溢出、野指针、线程死锁

